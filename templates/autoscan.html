{% extends 'base.html' %}

{% block title %}Autoscan{% endblock %}

{% block content %}
{% include 'navbar.html' %}

<!-- Where flash messages will be displayed -->
<div id="flash-messages" data-flash-messages="{{ get_flashed_messages(with_categories=true) | tojson | safe }}"></div>
<h2>Autoscan</h2>
<p>This page will be used for automated malware analysis.</p>

<!-- Upload file to uploads directory  -->
<form id="upload-form" method="POST" enctype="multipart/form-data" action="{{ url_for('upload_file') }}">
    <input type="file" name="file" id="file-input">
    <input type="submit" value="Upload" id="upload-button" style="display: none;">
</form>
<div id="upload-message" style="display: none;">Upload successful</div>

<br>
<!-- Display table of uploaded files -->
<table class="table table-striped table-bordered table-hover table-sm">
  <thead>
    <tr>
      <th scope="col"><i class="las la-hashtag"></i>.</th>
      <th scope="col">Name</th>
      <th scope="col"><i class="las la-calendar"></i>Uploaded</th>
      <th scope="col"><i class="las la-expand"></i>Size</th>
      <th scope="col"><i class="las la-id-badge"></i>Type</th>
      <th scope="col"><i class="las la-user-alt"></i>User</th>
      <th scope="col"><i class="las la-user-alt"></i>Status</th>
      <th scope="col"><i class="las la-user-alt"></i>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% if files %}
        {% for file in files %}
            <tr>
                <td>{{ file.id }}</td>
                <td>{{ file.file_path }}</td>
                <td>{{ file.date_uploaded }}</td>
                <td>{{ file.file_size }}</td>
                <td>{{ file.file_type }}</td>
                <td>{{ file.user }}</td>
                <td>{{ file.status }}</td>
                <td>
                    {% if file.status == 'unscanned' %}
                        <form onsubmit="startScan(event, {{ file.id }})">
                            <button type="submit" class="btn btn-outline-primary"><i class="las la-terminal"></i>Scan</button>
                            <input type="hidden" name="file_id" value="{{ file.id }}">
                        </form>
                    {% elif file.status == 'scanned' %}
                        <form action="{{ url_for('view_report', file_id=file.id) }}" method="get">
                            <button type="submit" class="btn btn-outline-secondary"><i class="las la-file-alt"></i> Report</button>
                        </form>
                    {% endif %}
                    <form action="{{ url_for('delete_file', id=file.id) }}" method="post">
                        <button type="submit" class="btn btn-outline-danger"><i class="las la-trash"></i>Delete</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
    {% else %}
    <tr>
      <td colspan="5">No files uploaded yet</td>
    </tr>
    {% endif %}
  </tbody>
</table>

<div class="container">
    <h5>Scan Results</h5>
    <div id="scan-popup"></div>
    <div id="scan-results" style="display: none;"></div>
</div>

<!-- <div id="scan-status" style="display: none;"></div>

<div id="scan-results" style="display: none;"></div> -->


<script src="{{ url_for('static', filename='autoscan.js') }}"></script>

<!-- Page End -->
</div>
{% endblock %}
